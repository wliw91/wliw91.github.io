---
title: 运维赛纪要
date: 2022-02-21
categories: tool
tags:
- Linux
- ctf
---

主要记录一下出运维赛的过程。

<!-- more -->

# 基础文件信息

## 1.dockerfile

```
#设置继承镜像
FROM ubuntu:18.04
#提供一些作者的信息
LABEL maintainer="valen"

#　适应国内网络情况，更换清华源，并下载多数情况下必要的软件包（可视自己情况增减）
RUN sed -i "s/http:\/\/archive.ubuntu.com/http:\/\/mirrors.tuna.tsinghua.edu.cn/g" /etc/apt/sources.list &&\
    apt-get update && \
    apt-get install -y software-properties-common vim ssh openssh-server sudo wget unzip net-tools

# 开启ssh远程登录
RUN rm -f /etc/ssh/sshd_config
ADD sshd_config  /etc/ssh/sshd_config
COPY start.sh /root/start.sh
RUN chmod 777 /root/start.sh
# 运维使用，添加了运维人员的公钥
RUN mkdir /root/.ssh
RUN echo 'ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDipDgwMgJEE1v0aFTL2PhHlCwgE082iSLiEuNhDfi5LQJ33LtwtIm0GaEwmEjoZdfaqyGJP5nkXBZ9WcVz5P9iRUdBUTQf0yzvnft3Bi+r6wEfsLNh9laUEoAQ7IrRCs8DCfkFXOJSBASGX31gnkeRGo3sfSet/0CFTniGaT5R2CsrUTdrMYMj2yx4FBwSr7vHqHMCjdoB7DJ3Y1UMXzDMtrduUJtsMLVl5MUuZSBsoUZExel/HCMWXVClwuDa/2QONc1oYaicL3fSbQJkIf3VxWKGb3HivxmlhFjBnAuJ93TQCVyJ353ZfiSLquf6el2RqCk1345sGOxkg8yVZxLd root@ubuntu' >> /root/.ssh/authorized_keys
RUN chmod 600 /root/.ssh/authorized_keys 
RUN chmod 700 /root/.ssh/

#开放端口
EXPOSE 22
#设置自启动命令
entrypoint ["/root/start.sh"]
CMD ["/root/start.sh"]
```

## 2.sshd_config

```
# 免密码登录
StrictModes no
# 开启rsa验证
RSAAuthentication yes
# 是否使用公钥
PubkeyAuthentication yes
# 公钥保存位置
AuthorizedKeysFile    /root/.ssh/authorized_keys
# 禁止使用密码登录
PasswordAuthentication no
```

## 3.start.sh

```
#!/bin/bash
service ssh restart
sleep infinity
```

遇到的问题

```
Configuring tzdata
------------------
Please select the geographic area in which you live. Subsequent configuration
questions will narrow this down by presenting a list of cities, representing
the time zones in which they are located.
 1. Africa      4. Australia  7. Atlantic  10. Pacific  13. Etc
 2. America     5. Arctic     8. Europe    11. SystemV
 3. Antarctica  6. Asia       9. Indian    12. US
Geographic area:
```

就在run前面加上

```
ENV DEBIAN_FRONTEND=noninteractive
```

或者

```
RUN DEBIAN_FRONTEND=noninteractive apt install -y tzdata
```



# 相关配置信息

## 1.定时任务crontab

### 安装 cron

执行如下命令

```
sudo apt-get install cron
```

### 检测你的service路径

执行命令 `which service`

```
root@ubuntu4146:/data/gitlabData/backups# which service
/usr/sbin/service
```

### 执行相关 cron命令、带上路径 /usr/sbin/service

比如执行命令 sudo /usr/sbin/service cron start ，启动 cron 服务

```
root@ubuntu4146:/data/gitlabData/backups# sudo /usr/sbin/service cron start 
start: Job is already running: cron
```

上面命令返回 Job is already running: cron 表示 cron命令早已经在运行中

通常你可以通过执行命令 ps -ef | grep cron查看 cron命令是否正在运行

```
root@ubuntu4146:/data/gitlabData/backups# ps -ef | grep cron
root      1096     1  0 10:40 ?        00:00:00 cron
root      2155 62366  0 10:45 pts/1    00:00:00 grep --color=auto cron
```

执行命令 sudo /usr/sbin/service cron status , 查看crontab服务状态

```
root@ubuntu4146:/data/gitlabData/backups# sudo /usr/sbin/service cron status
cron start/running, process 1096
```

执行命令 sudo /usr/sbin/service cron reload 重新 cron 服务配置

```
root@ubuntu4146:/data/gitlabData/backups# sudo /usr/sbin/service cron reload
```

执行命令 sudo /usr/sbin/service cron restart , 重新启动 cron 服务

```
root@ubuntu4146:/data/gitlabData/backups# sudo /usr/sbin/service cron restart 
cron stop/waiting
cron start/running, process 1096
```

执行命令 sudo /usr/sbin/service cron stop , 停止 cron 服务

```
root@ubuntu4146:/data/gitlabData/backups# sudo /usr/sbin/service cron stop
cron stop/waiting
```

